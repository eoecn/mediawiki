{"title":"Getting a Result from the Activity","text":"<p>\u8d1f\u8d23\u4eba\uff1a\u5c0f\u624b\u51b0\u51c9\n<\/p><p>\u539f\u6587\u94fe\u63a5\uff1a<a rel=\"nofollow\" target=\"_blank\" class=\"external free\" href=\"http:\/\/docs.eoeandroid.com\/training\/basics\/intents\/result.html\">http:\/\/docs.eoeandroid.com\/training\/basics\/intents\/result.html<\/a>\n<\/p>\n<table id=\"toc\" class=\"toc\"><tr><td><div id=\"toctitle\"><h2>\u76ee\u5f55<\/h2><\/div>\n<ul>\n<li class=\"toclevel-1 tocsection-1\"><a href=\"#Getting_a_Result_from_the_Activity\"><span class=\"tocnumber\">1<\/span> <span class=\"toctext\">Getting a Result from the Activity<\/span><\/a>\n<ul>\n<li class=\"toclevel-2 tocsection-2\"><a href=\"#.E5.90.AF.E5.8A.A8Activity\"><span class=\"tocnumber\">1.1<\/span> <span class=\"toctext\">\u542f\u52a8Activity<\/span><\/a><\/li>\n<li class=\"toclevel-2 tocsection-3\"><a href=\"#.E6.8E.A5.E6.94.B6.E8.BF.94.E5.9B.9E.E7.BB.93.E6.9E.9C\"><span class=\"tocnumber\">1.2<\/span> <span class=\"toctext\">\u63a5\u6536\u8fd4\u56de\u7ed3\u679c<\/span><\/a>\n<ul>\n<li class=\"toclevel-3 tocsection-4\"><a href=\"#.E8.AF.BB.E5.8F.96.E8.81.94.E7.B3.BB.E4.BA.BA.E6.95.B0.E6.8D.AE\"><span class=\"tocnumber\">1.2.1<\/span> <span class=\"toctext\">\u8bfb\u53d6\u8054\u7cfb\u4eba\u6570\u636e<\/span><\/a><\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<\/td><\/tr><\/table>\n<h1> <span class=\"mw-headline\" id=\"Getting_a_Result_from_the_Activity\">Getting a Result from the Activity<\/span><\/h1>\n<p>\u542f\u52a8\u4e00\u4e2aActivity\u4e0d\u4ec5\u4ec5\u6709\u4e00\u79cd\u65b9\u6cd5\u3002\u6211\u4eec\u53ef\u4ee5\u542f\u52a8\u53e6\u5916\u4e00\u4e2aActivity\u548c\u63a5\u6536\u4e00\u4e2a\u8fd4\u56de\u7684\u7ed3\u679c\u3002\u4e3a\u4e86\u63a5\u6536\u8fd4\u56de\u7684\u7ed3\u679c\uff0c\u6211\u4eec\u53ef\u4ee5\u8c03\u7528 startActivityForResult()\u65b9\u6cd5\u3002\n<\/p><p>\u4f8b\u5982\uff1a\u4f60\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u542f\u52a8\u4e00\u4e2a\u76f8\u673a\u5e94\u7528\uff0c\u63a5\u6536\u8fd4\u56de\u7684\u7167\u7247\u4f5c\u4e3a\u7ed3\u679c\u3002\u6216\u8005\uff0c\u4f60\u53ef\u4ee5\u542f\u52a8\u8054\u7cfb\u4eba\u5e94\u7528\u4e3a\u4e86\u5728\u8054\u7cfb\u4eba\u4e2d\u67e5\u627e\u4e00\u4e2a\u7528\u6237\uff0c\u4f60\u4f1a\u6536\u5230\u8054\u7cfb\u4eba\u7684\u8be6\u7ec6\u4f5c\u4e3a\u7ed3\u679c\u3002\n<\/p><p>\u5f53\u7136,Activity\u7684\u54cd\u5e94\u4e00\u5b9a\u8981\u88ab\u8bbe\u8ba1\u6709\u7ed3\u679c\u8fd4\u56de\u3002\u5f53\u662f\u8fd9\u6837\u7684\u8bdd\uff0c\u5b83\u53d1\u9001\u7ed3\u679c\u7ed9\u53e6\u5916\u4e00\u4e2aIntent\u5bf9\u8c61\u3002\u4f60\u7684Activity\u5728\u56de\u8c03\u51fd\u6570 onActivityResult()\u4e2d\u63a5\u6536\u8fd4\u56de\u7ed3\u679c\u3002\n<\/p>\n<div style=\"margin: 1em 0; padding: 10px; overflow: auto; background: #F7F7F7; border-left:4px solid; border-color:#258AAF;\">\n<p>Note: You can use explicit or implicit intents when you call startActivityForResult(). When starting one of your own activities to receive a result, you should use an explicit intent to ensure that you receive the expected result\n<\/p>\n<\/div>\n<h2> <span class=\"mw-headline\" id=\".E5.90.AF.E5.8A.A8Activity\">\u542f\u52a8Activity<\/span><\/h2>\n<p>\u4f60\u4f7f\u7528\u7684Intent\u5bf9\u8c61\u6ca1\u6709\u4ec0\u4e48\u7279\u522b\u7684\uff0c\u5f53\u4f60\u542f\u52a8\u4e00\u4e2aActivity\u9700\u8981\u7ed3\u679c\u8fd4\u56de\u65f6\u3002\u5f53\u6536\u5230Intent\u7684\u7ed3\u679c\u65f6\uff0c\u56de\u8c03\u63d0\u4f9b\u4e86\u76f8\u540c\u7684\u8bf7\u6c42\u7684\u4ee3\u7801\uff0c\u4f7f\u60a8\u7684\u5e94\u7528\u7a0b\u5e8f\u53ef\u4ee5\u6b63\u786e\u8bc6\u522b\u7ed3\u679c\uff0c\u5e76\u51b3\u5b9a\u5982\u4f55\u5904\u7406\u5b83\u3002\n<\/p><p>\u4f8b\u5982\uff1a\u8fd9\u91cc\u5c31\u662f\u5982\u4f55\u542f\u52a8\u4e00\u4e2aActivity\u8ba9\u7528\u6237\u9009\u62e9\u4e00\u4e2a\u8054\u7cfb\u4eba\u3002\n<\/p>\n<pre class=\"java\">&#160;\n  <span style=\"color: #000000; font-weight: bold;\">static<\/span> <span style=\"color: #000000; font-weight: bold;\">final<\/span> <span style=\"color: #993333;\">int<\/span> PICK_CONTACT_REQUEST = <span style=\"color: #cc66cc;\">1<\/span>;  <span style=\"color: #808080; font-style: italic;\">\/\/ The request code<\/span>\n  ...\n  <span style=\"color: #000000; font-weight: bold;\">private<\/span> <span style=\"color: #993333;\">void<\/span> pickContact<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n    Intent pickContactIntent = <span style=\"color: #000000; font-weight: bold;\">new<\/span> Intent<span style=\"color: #66cc66;\">&#40;<\/span>Intent.<span style=\"color: #006600;\">ACTION_PICK<\/span>, <span style=\"color: #000000; font-weight: bold;\">new<\/span> Uri<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #ff0000;\">&quot;content:\/\/contacts&quot;<\/span><span style=\"color: #66cc66;\">&#41;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n    pickContactIntent.<span style=\"color: #006600;\">setType<\/span><span style=\"color: #66cc66;\">&#40;<\/span>Phone.<span style=\"color: #006600;\">CONTENT_TYPE<\/span><span style=\"color: #66cc66;\">&#41;<\/span>; <span style=\"color: #808080; font-style: italic;\">\/\/ Show user only contacts w\/ phone numbers<\/span>\n    startActivityForResult<span style=\"color: #66cc66;\">&#40;<\/span>pickContactIntent, PICK_CONTACT_REQUEST<span style=\"color: #66cc66;\">&#41;<\/span>;\n  <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<h2> <span class=\"mw-headline\" id=\".E6.8E.A5.E6.94.B6.E8.BF.94.E5.9B.9E.E7.BB.93.E6.9E.9C\">\u63a5\u6536\u8fd4\u56de\u7ed3\u679c<\/span><\/h2>\n<p>\u5f53\u540e\u7eed\u7684Activity\u6267\u884c\u5b8c\u6210\u540e\u5e76\u8fd4\u56de\uff0c\u7cfb\u7edf\u8bb2\u8c03\u7528Activity\u7684 onActivityResult\uff08\uff09\u65b9\u6cd5\u3002\u8fd9\u4e2a\u65b9\u6cd5\u5305\u62ec\u4e09\u4e2a\u53c2\u6570\uff1a \n<\/p>\n<ul><li> \u8bf7\u6c42\u7684\u4ee3\u7801\uff0c\u4f60\u4f20\u9012\u7ed9 startActivityForResult\uff08\uff09\u3002\n<\/li><li> \u7531\u7b2c\u4e8c\u4e2aActivity\u6307\u5b9a\u7684\u7ed3\u679c\u4ee3\u7801\u3002\u5982\u679c\u64cd\u4f5c\u6210\u529f\u4e86\u5c31\u662fRESULT_OK,\u7531\u4e8e\u67d0\u79cd\u539f\u56e0\uff0c\u7528\u6237\u5907\u4efd\u6216\u8005\u64cd\u7eb5\u5931\u8d25\uff0c\u8fd4\u56de\u7ed3\u679c\u662fRESULT_CANCELED\u3002 \n<\/li><li> \u643a\u5e26\u7740\u7ed3\u679c\u4ee3\u7801\u7684Intent. \n<\/li><\/ul>\n<p>\u4f8b\u5982:\n<\/p>\n<pre class=\"java\">&#160;\n   @Override \n  <span style=\"color: #000000; font-weight: bold;\">protected<\/span> <span style=\"color: #993333;\">void<\/span> onActivityResult<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #993333;\">int<\/span> requestCode, <span style=\"color: #993333;\">int<\/span> resultCode, Intent data<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span> \n    <span style=\"color: #808080; font-style: italic;\">\/\/ Check which request we're responding to <\/span>\n    <span style=\"color: #b1b100;\">if<\/span> <span style=\"color: #66cc66;\">&#40;<\/span>requestCode == PICK_CONTACT_REQUEST<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span> \n        <span style=\"color: #808080; font-style: italic;\">\/\/ Make sure the request was successful <\/span>\n        <span style=\"color: #b1b100;\">if<\/span> <span style=\"color: #66cc66;\">&#40;<\/span>resultCode == RESULT_OK<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span> \n            <span style=\"color: #808080; font-style: italic;\">\/\/ The user picked a contact. <\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ The Intent's data Uri identifies which contact was selected.<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Do something with the contact here (bigger example below<\/span>\n        <span style=\"color: #66cc66;\">&#125;<\/span> \n    <span style=\"color: #66cc66;\">&#125;<\/span>\n   <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<p>\u5728\u8fd9\u4e2a\u4f8b\u5b50\u4e2d\uff0cAndroid\u7684\u8054\u7cfb\u4eba\u5e94\u7528\u7a0b\u5e8f\u8fd4\u56de\u7684Intent\u7ed3\u679c\u63d0\u4f9b\u4e86\u4e00\u4e2a\u5185\u5bb9URI\u6807\u8bc6\u7528\u6237\u9009\u5b9a\u7684\u8054\u7cfb\u4eba\u3002\n<\/p><p>\u4e3a\u4e86\u6210\u529f\u5730\u5904\u7406\u7ed3\u679c\uff0c\u4f60\u5fc5\u987b\u660e\u767dIntent\u7684\u7ed3\u679c\u5c06\u662f\u4ec0\u4e48\u683c\u5f0f \u3002\u8fd9\u6837\u505a\u662f\u5f88\u5bb9\u6613\u7684\uff0c\u5f53\u8fd4\u56de\u7ed3\u679c\u7684Activity\u662f\u81ea\u5df1\u7684ACtivity\u4e4b\u4e00\u3002\u5e94\u7528\u7a0b\u5e8f\u5305\u62ecAndroid\u5e73\u53f0\u63d0\u4f9b\u81ea\u5df1\u7684API\uff0c\u4f60\u53ef\u4ee5\u6307\u5b9a\u5177\u4f53\u7684\u7ed3\u679c\u6570\u636e\u3002\u4f8b\u5982\uff0c\u8054\u7cfb\u4eba\u5e94\u7528\u7a0b\u5e8f\u59cb\u7ec8\u8fd4\u56de\u9009\u5b9a\u8054\u7cfb\u4eba\u7684\u5185\u5bb9URI\u6807\u8bc6\uff0c\u76f8\u673a\u5e94\u7528\u7a0b\u5e8f\u8fd4\u56de\u4e00\u4e2a\u4f4d\u56fe\u3002\n<\/p>\n<h3> <span class=\"mw-headline\" id=\".E8.AF.BB.E5.8F.96.E8.81.94.E7.B3.BB.E4.BA.BA.E6.95.B0.E6.8D.AE\">\u8bfb\u53d6\u8054\u7cfb\u4eba\u6570\u636e<\/span><\/h3>\n<p>\u6709\u5173\u5982\u4f55\u4ece\u7ed3\u679c\u4e2d\u8bfb\u53d6\u6570\u636e\u7684\u8be6\u7ec6\u4fe1\u606f\uff0c\u5728\u4e0a\u9762\u7684\u4ee3\u7801\u4e2d\u5c55\u793a\u4e86\u5982\u4f55\u4ece\u8054\u7cfb\u4eba\u7684\u5e94\u7528\u7a0b\u5e8f\u4e2d\u8bfb\u53d6\u8054\u7cfb\u4eba\u7684\u6570\u636e\u3002\u4e0b\u9762\u7684\u4ee3\u7801\u5c55\u793a\u4e86\u5982\u4f55\u4ece\u9009\u9876\u7684\u8054\u7cfb\u4eba\u7684\u67e5\u8be2\u7ed3\u679c\u6570\u636e\u4e2d\u83b7\u53d6\u7528\u6237\u7684\u7535\u8bdd\u53f7\u7801\u3002\n<\/p>\n<pre class=\"java\">&#160;\n   @Override\n   <span style=\"color: #000000; font-weight: bold;\">protected<\/span> <span style=\"color: #993333;\">void<\/span> onActivityResult<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #993333;\">int<\/span> requestCode, <span style=\"color: #993333;\">int<\/span> resultCode, Intent data<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n    <span style=\"color: #808080; font-style: italic;\">\/\/ Check which request it is that we're responding to<\/span>\n    <span style=\"color: #b1b100;\">if<\/span> <span style=\"color: #66cc66;\">&#40;<\/span>requestCode == PICK_CONTACT_REQUEST<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ Make sure the request was successful<\/span>\n        <span style=\"color: #b1b100;\">if<\/span> <span style=\"color: #66cc66;\">&#40;<\/span>resultCode == RESULT_OK<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Get the URI that points to the selected contact<\/span>\n            Uri contactUri = data.<span style=\"color: #006600;\">getData<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ We only need the NUMBER column, because there will be only one row in the result<\/span>\n            <a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AString+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">String<\/span><\/a><span style=\"color: #66cc66;\">&#91;<\/span><span style=\"color: #66cc66;\">&#93;<\/span> projection = <span style=\"color: #66cc66;\">&#123;<\/span>Phone.<span style=\"color: #006600;\">NUMBER<\/span><span style=\"color: #66cc66;\">&#125;<\/span>;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Perform the query on the contact to get the NUMBER column<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ We don't need a selection or sort order (there's only one result for the given URI)<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ CAUTION: The query() method should be called from a separate thread to avoid blocking<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ your app's UI thread. (For simplicity of the sample, this code doesn't do that.)<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Consider using CursorLoader to perform the query.<\/span>\n            <a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3ACursor+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">Cursor<\/span><\/a> cursor = getContentResolver<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>\n                    .<span style=\"color: #006600;\">query<\/span><span style=\"color: #66cc66;\">&#40;<\/span>contactUri, projection, <span style=\"color: #000000; font-weight: bold;\">null<\/span>, <span style=\"color: #000000; font-weight: bold;\">null<\/span>, <span style=\"color: #000000; font-weight: bold;\">null<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            cursor.<span style=\"color: #006600;\">moveToFirst<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Retrieve the phone number from the NUMBER column<\/span>\n            <span style=\"color: #993333;\">int<\/span> column = cursor.<span style=\"color: #006600;\">getColumnIndex<\/span><span style=\"color: #66cc66;\">&#40;<\/span>Phone.<span style=\"color: #006600;\">NUMBER<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            <a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AString+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">String<\/span><\/a> number = cursor.<span style=\"color: #006600;\">getString<\/span><span style=\"color: #66cc66;\">&#40;<\/span>column<span style=\"color: #66cc66;\">&#41;<\/span>;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Do something with the phone number...<\/span>\n        <span style=\"color: #66cc66;\">&#125;<\/span>\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n   <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<div style=\"margin: 1em 0; padding: 10px; overflow: auto; background: #F7F7F7; border-left:4px solid; border-color:#258AAF;\">\n<p>Note: Before Android 2.3 (API level 9), performing a query on the Contacts Provider (like the one shown above) requires that your app declare the READ_CONTACTS permission (see Security and Permissions). However, beginning with Android 2.3, the Contacts\/People app grants your app a temporary permission to read from the Contacts Provider when it returns you a result. The temporary permission applies only to the specific contact requested, so you cannot query a contact other than the one specified by the intent's Uri, unless you do declare the READ_CONTACTS permission.\n<\/p>\n<\/div>"}
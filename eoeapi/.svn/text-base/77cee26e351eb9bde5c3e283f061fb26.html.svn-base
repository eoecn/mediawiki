{"title":"Communicating with Other Fragments","text":"<p>\u539f\u6587\u94fe\u63a5\uff1a<a rel=\"nofollow\" target=\"_blank\" class=\"external free\" href=\"http:\/\/docs.eoeandroid.com\/intl\/zh-CN\/training\/basics\/fragments\/communicating.html#Deliver\">http:\/\/docs.eoeandroid.com\/intl\/zh-CN\/training\/basics\/fragments\/communicating.html#Deliver<\/a>\n<\/p>\n<table id=\"toc\" class=\"toc\"><tr><td><div id=\"toctitle\"><h2>\u76ee\u5f55<\/h2><\/div>\n<ul>\n<li class=\"toclevel-1 tocsection-1\"><a href=\"#.E4.B8.8E.E5.85.B6.E4.BB.96Fragment.E4.BA.A4.E4.BA.92_Communication_with_Other_Fragments\"><span class=\"tocnumber\">1<\/span> <span class=\"toctext\">\u4e0e\u5176\u4ed6Fragment\u4ea4\u4e92 Communication with Other Fragments<\/span><\/a>\n<ul>\n<li class=\"toclevel-2 tocsection-2\"><a href=\"#.E5.AE.9A.E4.B9.89.E4.B8.80.E4.B8.AA.E6.8E.A5.E5.8F.A3_Define_an_Interface\"><span class=\"tocnumber\">1.1<\/span> <span class=\"toctext\">\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3 Define an Interface<\/span><\/a><\/li>\n<li class=\"toclevel-2 tocsection-3\"><a href=\"#.E5.AE.9E.E7.8E.B0.E6.8E.A5.E5.8F.A3_Implement_the_Interface\"><span class=\"tocnumber\">1.2<\/span> <span class=\"toctext\">\u5b9e\u73b0\u63a5\u53e3 Implement the Interface<\/span><\/a><\/li>\n<li class=\"toclevel-2 tocsection-4\"><a href=\"#Deliver_a_Message_to_a_Fragment\"><span class=\"tocnumber\">1.3<\/span> <span class=\"toctext\">Deliver a Message to a Fragment<\/span><\/a><\/li>\n<\/ul>\n<\/li>\n<\/ul>\n<\/td><\/tr><\/table>\n<h1> <span class=\"mw-headline\" id=\".E4.B8.8E.E5.85.B6.E4.BB.96Fragment.E4.BA.A4.E4.BA.92_Communication_with_Other_Fragments\"><b>\u4e0e\u5176\u4ed6Fragment\u4ea4\u4e92 Communication with Other Fragments<\/b><\/span><\/h1>\n<p>\u4e3a\u4e86\u91cd\u7528Fragment UI\u7ec4\u4ef6\uff0c\u4f60\u5e94\u8be5\u5c06Fragment\u5efa\u7acb\u6210\u5b8c\u5168\u72ec\u7acb\uff0c\u6a21\u5757\u5316\u5e76\u4e14\u5b9a\u4e49\u4e86\u81ea\u5df1\u5e03\u5c40\u548c\u884c\u4e3a\u7684\u7ec4\u4ef6\u3002\u4e00\u65e6\u4f60\u5b9a\u4e49\u4e86\u8fd9\u4e9b\u53ef\u91cd\u7528\u7684Fragment\uff0c\n\u4f60\u53ef\u4ee5\u901a\u8fc7activity\uff0c\u5e94\u7528\u7a0b\u5e8f\u903b\u8f91\u4f7f\u5b83\u4eec\u5173\u8054\uff0c\u4ea4\u4e92\u4ee5\u7ec4\u6210\u4e00\u4e2a\u6574\u4f53\u590d\u5408\u578bUI\u3002\n\u901a\u5e38\u60c5\u51b5\u4e0b\uff0c\u4f60\u5e0c\u671b\u4e00\u4e2aFragment\u53ef\u4ee5\u4e0e\u53e6\u4e00\u4e2a\u4ea4\u4e92\u3002\u6bd4\u5982\u5728\u7528\u6237\u4e8b\u4ef6\u7684\u57fa\u7840\u4e0a\u53bb\u4fee\u6539\u5185\u5bb9\uff0c\u6240\u6709Fragment\u5230Fragment\u7684\u4ea4\u4e92\u90fd\u662f\u901a\u8fc7\u76f8\u5173\u8054\u7684activity\u6765\u505a\u7684\uff0c\u4e24\u4e2afragment\u5e94\u8be5\u4ece\u4e0d\u76f4\u63a5\u4ea4\u4e92\uff1b\n<\/p>\n<h2> <span class=\"mw-headline\" id=\".E5.AE.9A.E4.B9.89.E4.B8.80.E4.B8.AA.E6.8E.A5.E5.8F.A3_Define_an_Interface\"><b>\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3 Define an Interface<\/b><\/span><\/h2>\n<p>\u4e3a\u4e86\u5141\u8bb8Fragment\u4e0e\u5b83\u7684activity\u4ea4\u4e92\uff0c\u4f60\u53ef\u4ee5\u5728fragment\u7c7b\u4e2d\u5b9a\u4e49\u4e00\u4e2a\u63a5\u53e3\u5e76\u4e14\u5728activity\u4e2d\u5b9e\u73b0\u5b83\u3002fragment\u53ef\u4ee5\u5728onAttach()\u65b9\u6cd5\u4e2d\u83b7\u53d6\u63a5\u53e3\u7684\u5b9e\u73b0\u5e76\u8c03\u7528\u63a5\u53e3\u7684\u65b9\u6cd5\u4e0eactivity\u4ea4\u4e92\u3002\n\u4ee5\u4e0b\u662ffragment\u5230activity\u7684\u4ea4\u4e92\u4f8b\u5b50\uff1a\n<\/p>\n<pre class=\"java\">&#160;\n<span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #000000; font-weight: bold;\">class<\/span> HeadlinesFragment <span style=\"color: #000000; font-weight: bold;\">extends<\/span> ListFragment <span style=\"color: #66cc66;\">&#123;<\/span>\n    OnHeadlineSelectedListener mCallback;\n&#160;\n    <span style=\"color: #808080; font-style: italic;\">\/\/ Container Activity must implement this interface<\/span>\n    <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #000000; font-weight: bold;\">interface<\/span> OnHeadlineSelectedListener <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #993333;\">void<\/span> onArticleSelected<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #993333;\">int<\/span> position<span style=\"color: #66cc66;\">&#41;<\/span>;\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;\n    @Override\n    <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #993333;\">void<\/span> onAttach<span style=\"color: #66cc66;\">&#40;<\/span>Activity activity<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #000000; font-weight: bold;\">super<\/span>.<span style=\"color: #006600;\">onAttach<\/span><span style=\"color: #66cc66;\">&#40;<\/span>activity<span style=\"color: #66cc66;\">&#41;<\/span>;\n&#160;\n        <span style=\"color: #808080; font-style: italic;\">\/\/ This makes sure that the container activity has implemented<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ the callback interface. If not, it throws an exception<\/span>\n        <span style=\"color: #000000; font-weight: bold;\">try<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n            mCallback = <span style=\"color: #66cc66;\">&#40;<\/span>OnHeadlineSelectedListener<span style=\"color: #66cc66;\">&#41;<\/span> activity;\n        <span style=\"color: #66cc66;\">&#125;<\/span> <span style=\"color: #000000; font-weight: bold;\">catch<\/span> <span style=\"color: #66cc66;\">&#40;<\/span><a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AClassCastException+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">ClassCastException<\/span><\/a> e<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n            <span style=\"color: #000000; font-weight: bold;\">throw<\/span> <span style=\"color: #000000; font-weight: bold;\">new<\/span> <a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AClassCastException+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">ClassCastException<\/span><\/a><span style=\"color: #66cc66;\">&#40;<\/span>activity.<span style=\"color: #006600;\">toString<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>\n                    + <span style=\"color: #ff0000;\">&quot; must implement OnHeadlineSelectedListener&quot;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n        <span style=\"color: #66cc66;\">&#125;<\/span>\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;\n    ...\n<span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<p>\u73b0\u5728fragment\u53ef\u4ee5\u4f7f\u7528OnHeadlineSelectedListener\u7684\u5b9e\u4f8bmCallback\u8c03\u7528onArticleSelected()\u65b9\u6cd5(\u6216\u8005\u5176\u4ed6\u63a5\u53e3\u5185\u7684\u65b9\u6cd5)\u63d0\u4f9b\u4fe1\u606f\u7ed9activity\u4e86\u3002\n\u4f8b\u5982\uff0c\u5f53 \u7528\u6237\u70b9\u51fblist item(list\u5b50\u9879)\u65f6\u5c31\u4f1a\u8c03\u7528\u4e0b\u9762\u5728fragment\u7684\u65b9\u6cd5\u3002fragment\u4f7f\u7528\u56de\u8c03\u63a5\u53e3\u63d0\u4f9b\u4e8b\u4ef6\u5230\u7236\u7684activity\u3002\n<\/p>\n<pre class=\"java\">&#160;\n@Override\n    <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #993333;\">void<\/span> onListItemClick<span style=\"color: #66cc66;\">&#40;<\/span><a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AListView+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">ListView<\/span><\/a> l, <a href=\"http:\/\/www.google.com\/search?hl=en&amp;q=allinurl%3AView+java.sun.com&amp;btnI=I%27m%20Feeling%20Lucky\"><span style=\"color: #aaaadd; font-weight: bold;\">View<\/span><\/a> v, <span style=\"color: #993333;\">int<\/span> position, <span style=\"color: #993333;\">long<\/span> id<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ Send the event to the host activity<\/span>\n        mCallback.<span style=\"color: #006600;\">onArticleSelected<\/span><span style=\"color: #66cc66;\">&#40;<\/span>position<span style=\"color: #66cc66;\">&#41;<\/span>;\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<h2> <span class=\"mw-headline\" id=\".E5.AE.9E.E7.8E.B0.E6.8E.A5.E5.8F.A3_Implement_the_Interface\"><b>\u5b9e\u73b0\u63a5\u53e3 Implement the Interface<\/b><\/span><\/h2>\n<p>\u4e3a\u4e86\u63a5\u6536\u6765\u81eafragment\u7684\u4e8b\u4ef6\u56de\u8c03\uff0c\u4e3bactivity(\u4f60\u9700\u8981\u7528\u6765\u4e0efragment\u4ea4\u4e92\u7684activity)\u5fc5\u987b\u5b9e\u73b0\u5b9a\u4e49\u5728fragment\u7c7b\u4e2d\u7684\u63a5\u53e3\u3002\n\u4f8b\u5982\uff1a\u4e0b\u9762\u8fd9\u4e2aactivity\u5c31\u5b9e\u73b0\u4e86\u4e0a\u4e00\u4f8b\u5b50\u4e2d\u7684\u63a5\u53e3\uff1a\n<\/p>\n<pre class=\"java\">&#160;\n<span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #000000; font-weight: bold;\">static<\/span> <span style=\"color: #000000; font-weight: bold;\">class<\/span> MainActivity <span style=\"color: #000000; font-weight: bold;\">extends<\/span> Activity\n        <span style=\"color: #000000; font-weight: bold;\">implements<\/span> HeadlinesFragment.<span style=\"color: #006600;\">OnHeadlineSelectedListener<\/span><span style=\"color: #66cc66;\">&#123;<\/span>\n    ...\n&#160;\n    <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #993333;\">void<\/span> onArticleSelected<span style=\"color: #66cc66;\">&#40;<\/span>Uri articleUri<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ The user selected the headline of an article from the HeadlinesFragment<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ Do something here to display that article<\/span>\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n<span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>\n<h2> <span class=\"mw-headline\" id=\"Deliver_a_Message_to_a_Fragment\">Deliver a Message to a Fragment<\/span><\/h2>\n<p>\u4e3bactivity\u53ef\u4ee5\u4f7f\u7528findFragmentById()\u65b9\u6cd5\u83b7\u53d6Fragment\u5b9e\u4f8b\uff0c\u7136\u540e\u76f4\u63a5\u8c03\u7528fragment\u7684\u516c\u5171\u65b9\u6cd5\u63d0\u4f9b\u4fe1\u606f\u7ed9fragment\u3002\n<\/p><p>\u4f8b\u5982,\u60f3\u8c61\u4e00\u4e0b\u5728\u4e0a\u9762\u663e\u793a\u7684\u90a3\u4e2aactivity\u4e2d\u53ef\u80fd\u5305\u542b\u53e6\u5916\u4e00\u4e2afragment\uff0c\u5e76\u4e14\u7528\u6765\u663e\u793a\u7531\u4e0a\u9762\u90a3\u4e2a\u56de\u8c03\u65b9\u6cd5\u8fd4\u56de\u7684\u6570\u636e\u6307\u5b9a\u7684\u9879\u76ee\n\u5728\u8fd9\u4e2a\u6848\u4f8b\u4e2d\uff0c\u8fd9\u4e2aactivity\u53ef\u4ee5\u4ece\u56de\u8c03\u51fd\u6570\u4e2d\u83b7\u5f97\u4fe1\u606f\u5e76\u4e14\u4f20\u9012\u7ed9\u5176\u4ed6\u663e\u793a\u9879\u76ee\u7684fragment\n<\/p>\n<pre class=\"java\">&#160;\n<span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #000000; font-weight: bold;\">static<\/span> <span style=\"color: #000000; font-weight: bold;\">class<\/span> MainActivity <span style=\"color: #000000; font-weight: bold;\">extends<\/span> Activity\n        <span style=\"color: #000000; font-weight: bold;\">implements<\/span> HeadlinesFragment.<span style=\"color: #006600;\">OnHeadlineSelectedListener<\/span><span style=\"color: #66cc66;\">&#123;<\/span>\n    ...\n&#160;\n    <span style=\"color: #000000; font-weight: bold;\">public<\/span> <span style=\"color: #993333;\">void<\/span> onArticleSelected<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #993333;\">int<\/span> position<span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ The user selected the headline of an article from the HeadlinesFragment<\/span>\n        <span style=\"color: #808080; font-style: italic;\">\/\/ Do something here to display that article<\/span>\n&#160;\n        ArticleFragment articleFrag = <span style=\"color: #66cc66;\">&#40;<\/span>ArticleFragment<span style=\"color: #66cc66;\">&#41;<\/span>\n                getSupportFragmentManager<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>.<span style=\"color: #006600;\">findFragmentById<\/span><span style=\"color: #66cc66;\">&#40;<\/span>R.<span style=\"color: #006600;\">id<\/span>.<span style=\"color: #006600;\">article_fragment<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n&#160;\n        <span style=\"color: #b1b100;\">if<\/span> <span style=\"color: #66cc66;\">&#40;<\/span>articleFrag&#160;!= <span style=\"color: #000000; font-weight: bold;\">null<\/span><span style=\"color: #66cc66;\">&#41;<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ If article frag is available, we're in two-pane layout...<\/span>\n&#160;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Call a method in the ArticleFragment to update its content<\/span>\n            articleFrag.<span style=\"color: #006600;\">updateArticleView<\/span><span style=\"color: #66cc66;\">&#40;<\/span>position<span style=\"color: #66cc66;\">&#41;<\/span>;\n        <span style=\"color: #66cc66;\">&#125;<\/span> <span style=\"color: #b1b100;\">else<\/span> <span style=\"color: #66cc66;\">&#123;<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Otherwise, we're in the one-pane layout and must swap frags...<\/span>\n&#160;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Create fragment and give it an argument for the selected article<\/span>\n            ArticleFragment newFragment = <span style=\"color: #000000; font-weight: bold;\">new<\/span> ArticleFragment<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            Bundle args = <span style=\"color: #000000; font-weight: bold;\">new<\/span> Bundle<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n            args.<span style=\"color: #006600;\">putInt<\/span><span style=\"color: #66cc66;\">&#40;<\/span>ArticleFragment.<span style=\"color: #006600;\">ARG_POSITION<\/span>, position<span style=\"color: #66cc66;\">&#41;<\/span>;\n            newFragment.<span style=\"color: #006600;\">setArguments<\/span><span style=\"color: #66cc66;\">&#40;<\/span>args<span style=\"color: #66cc66;\">&#41;<\/span>;\n&#160;\n            FragmentTransaction transaction = getSupportFragmentManager<span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>.<span style=\"color: #006600;\">beginTransaction<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n&#160;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Replace whatever is in the fragment_container view with this fragment,<\/span>\n            <span style=\"color: #808080; font-style: italic;\">\/\/ and add the transaction to the back stack so the user can navigate back<\/span>\n            transaction.<span style=\"color: #006600;\">replace<\/span><span style=\"color: #66cc66;\">&#40;<\/span>R.<span style=\"color: #006600;\">id<\/span>.<span style=\"color: #006600;\">fragment_container<\/span>, newFragment<span style=\"color: #66cc66;\">&#41;<\/span>;\n            transaction.<span style=\"color: #006600;\">addToBackStack<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #000000; font-weight: bold;\">null<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n&#160;\n            <span style=\"color: #808080; font-style: italic;\">\/\/ Commit the transaction<\/span>\n            transaction.<span style=\"color: #006600;\">commit<\/span><span style=\"color: #66cc66;\">&#40;<\/span><span style=\"color: #66cc66;\">&#41;<\/span>;\n        <span style=\"color: #66cc66;\">&#125;<\/span>\n    <span style=\"color: #66cc66;\">&#125;<\/span>\n<span style=\"color: #66cc66;\">&#125;<\/span>\n&#160;<\/pre>"}